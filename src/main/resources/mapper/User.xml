<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.WAREHOUSE.dao.UserDAO">

  <!-- User.listUser -->
  <select
  	id="listUser"
  	parameterType="hashmap"
  	resultType="User"
  >
    <![CDATA[
    SELECT
      A.userID, A.userNm, A.phone, A.email, A.uLevel, B.itemNm,
      CASE WHEN A.flagYN = 'Y' THEN "유효" ELSE "무효" END flagYN
    FROM
      tblUser A
    LEFT JOIN (
      SELECT itemCd, itemNm
      FROM tblCommonCd
      WHERE groupCd = '0001'
    ) B ON A.uLevel = B.itemCd
    ]]>
    <if test='findUserNm!="" and findUserNm!=null'>
      WHERE (
        A.userNm LIKE CONCAT('%', #{findUserNm}, '%') OR
        A.userID LIKE CONCAT('%', #{findUserNm}, '%')
      )
    </if>
    ORDER BY
      A.userNm ASC
  </select>

  <!-- User.showUser -->
  <select
  	id="showUser"
  	parameterType="hashmap"
  	resultType="User"
  >
    <![CDATA[
    SELECT
      A.userID, A.passwd, A.userNm, A.phone, A.email, A.uLevel, A.compCd, A.uPerm, A.flagYN
    FROM
      tblUser A
    WHERE
      A.userID = #{userID}
    ]]>
  </select>

  <!-- User.checkUserID -->
  <select
  	id="checkUserID"
  	parameterType="hashmap"
  	resultType="Integer"
  >
    SELECT
      COUNT(*) cnt
    FROM
      tblUser
    WHERE
      userID = #{userID}
  </select>

  <update
    id="updatePw"
    parameterType="hashmap"
  >
    /* User.updatePw */
    UPDATE
      tblUser
    SET
      passwd = #{passwd}
    WHERE
      userID = #{userID}
  </update>

  <!-- User.listUserPerm -->
  <select
  	id="listUserPerm"
  	parameterType="hashmap"
    resultType="hashmap"
  >
    <![CDATA[
    SELECT
      page, subPage, pageUrl, pageNm, pageOrder, pageNo
    FROM
      tblSysMenu
    WHERE
      flagYN = 'Y' AND subPage!='00'
    ORDER BY
      pageOrder
    ]]>
  </select>

  <!-- User.saveUser -->
  <select
  	id="saveUser"
  	parameterType="User"
  	resultType="Integer"
  >
    CALL sp_User (
      #{userID},
      #{passwd},
      #{userNm},
      #{phone},
      #{email},
      #{uLevel},
      #{compCd},
      #{uPerm},
      #{flagYN},
      #{issueID}
    );
  </select>
</mapper>